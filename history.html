<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SOTD</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        @font-face { 
            font-family: 'Chantel'; 
            /* FIXED: Looking for file in the same folder, not subfolder */
            src: url('Chantal_Medium.otf'); 
        }
        body { 
            background-color: #ffe6c1; 
            font-family: 'Chantel', sans-serif; 
            margin: 0; 
            color: black;
        }
        .uppercase-text { text-transform: uppercase; letter-spacing: 0.05em; }
        h1, h2, h3, button, a { font-weight: normal; }
    </style>
</head>
<body class="flex flex-col min-h-screen">

    <header class="p-6 flex justify-between items-center max-w-md mx-auto w-full">
        <h1 class="text-3xl font-bold uppercase-text leading-none">SOTD</h1>
        <button onclick="toggleModal()" class="bg-black text-[#ffe6c1] px-6 py-2 rounded-lg text-sm uppercase-text hover:opacity-80 transition">
            SUBSCRIBE
        </button>
    </header>

    <main class="flex-grow flex flex-col px-6 w-full max-w-md mx-auto mt-4">
        
        <div class="text-left uppercase-text mb-6 pl-1">
            <p id="date" class="text-sm mb-2 opacity-90 font-bold"></p>
            <h2 id="song-name" class="text-4xl mb-1 leading-none">LOADING...</h2>
            <p id="artist-name" class="text-2xl">- </p>
        </div>

        <div class="w-full aspect-square bg-black shadow-xl overflow-hidden rounded-lg border-2 border-black mb-8 relative">
             <iframe id="yt-player" class="w-full h-full" frameborder="0" allow="autoplay; encrypted-media; picture-in-picture"></iframe>
        </div>

        <div class="text-center mb-10">
            <a id="song-link" href="#" target="_blank" class="uppercase-text text-lg border-b-2 border-black pb-0.5 font-bold hover:opacity-70">
                LINK
            </a>
        </div>
    </main>

    <footer class="text-center uppercase-text w-full mt-auto bg-black text-[#ffe6c1] py-12">
        <p class="text-lg mb-2 font-bold">FOLLOW ME</p>
        <p class="text-3xl mb-8 font-bold">@NBAWDEN12</p>
        
        <div class="flex flex-col items-center gap-6 mb-10">
            <a href="https://music.youtube.com/playlist?list=PLKVW_rYd51r6iejJlIIflJe6Lj6CR3x2c&si=TSLcj0kUcan0I_W5" target="_blank" class="bg-[#ffe6c1] text-black px-8 py-3 rounded-lg text-lg min-w-[200px] font-bold">
                YouTube Music
            </a>
            <div class="flex gap-8 text-3xl">
                <a href="https://music.youtube.com/@ColeMartin13" target="_blank" class="hover:text-white"><i class="fab fa-youtube"></i></a>
                <a href="https://www.instagram.com/nbawden12" target="_blank" class="hover:text-white"><i class="fab fa-instagram"></i></a>
            </div>
        </div>
        
        <div class="opacity-80">
            <a href="history.html" class="block text-sm border-b border-[#ffe6c1] inline-block pb-0.5 hover:text-white mb-4">ARCHIVE</a>
            <p class="text-xs">Â© 2035 BY COLE MARTIN</p>
        </div>
    </footer>

    <div id="sub-modal" class="fixed inset-0 bg-black/95 hidden flex items-center justify-center p-4 z-50">
        <div class="bg-[#ffe6c1] p-2 rounded-lg max-w-md w-full relative h-[600px]">
            <button onclick="toggleModal()" class="absolute top-4 right-4 text-3xl font-bold z-10">&times;</button>
            <iframe 
                src="https://07239e97.sibforms.com/serve/MUIFABQnAn8U4F2of0x_BrqzKaob9NT6VXUXMsG0JiCGlRYzgURMzLz_XNEI03AwyD5Hi0DBhIaELsK4j0rIkuWm1WVuh0ZT-ApmEyeAcIVYfmYm23RzGic81PMEkGRmZf-Q9G-dpGmjq0oZqbwCvAw99SzQjO7NxjtwW0ewKzlR5TgRR8EN_GSIOQmX0XRp1qG6RvyrSDuW0xe_dg==" 
                width="100%" height="100%" frameborder="0" style="background: transparent;">
            </iframe>
        </div>
    </div>

    <script>
        function toggleModal() { document.getElementById('sub-modal').classList.toggle('hidden'); }
        
        async function init() {
            try {
                const sheetLink = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vSvY09mxoHhTuK_V3Ma0xcBRv5wSrvBMX34_rlhnoSiGIztZux5z7TZsvqCHKRbFcSaXG90c3GLU8nN/pub?output=csv';
                
                const res = await fetch(sheetLink);
                if (!res.ok) throw new Error("Connection failed");
                const csv = await res.text();
                
                const rows = csv.split(/\r?\n/).map(line => {
                    const result = [];
                    let current = '';
                    let inQuotes = false;
                    for (let char of line) {
                        if (char === '"') inQuotes = !inQuotes;
                        else if (char === ',' && !inQuotes) {
                            result.push(current);
                            current = '';
                        } else current += char;
                    }
                    result.push(current);
                    return result;
                });

                const today = new Date().toLocaleDateString('en-CA', { timeZone: 'America/Toronto' });
                
                let match = rows.find(r => r[0] && r[0].includes(today));
                if (!match) match = rows.filter(r => r[3] && r[3].includes('http')).pop();

                if (match) {
                    let vId = "";
                    const url = match[3];
                    if (url.includes('youtu.be/')) vId = url.split('youtu.be/')[1].split('?')[0];
                    else if (url.includes('v=')) vId = url.split('v=')[1].split('&')[0];
                    else if (url.includes('/embed/')) vId = url.split('/embed/')[1].split('?')[0];
                    
                    const origin = window.location.origin;
                    document.getElementById('yt-player').src = `https://www.youtube.com/embed/${vId}?autoplay=0&rel=0&origin=${origin}`;
                    
                    document.getElementById('song-name').innerText = match[1].toUpperCase();
                    document.getElementById('date').innerText = match[0];
                    document.getElementById('artist-name').innerText = "- " + match[2].toUpperCase();
                    document.getElementById('song-link').href = match[3];
                }
            } catch (err) {
                console.error("Error:", err);
                document.getElementById('song-name').innerText = "DATA ERROR";
            }
        }
        init();
    </script>
</body>
</html>
